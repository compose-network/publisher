# Example configuration file for POC Shared Publisher
# Copy this file to config.yaml and adjust values as needed
#
# ENV Variables Support:
# All config values can be overridden with ENV variables using the pattern:
# <SECTION>_<KEY> (dots replaced with underscores)
#
# Examples:
#   SERVER_LISTEN_ADDR=":9090"
#   SERVER_MAX_CONNECTIONS=200
#   METRICS_PORT=3000
#   LOG_LEVEL=debug
#   LOG_PRETTY=true

# Server configuration
server:
  # TCP listen address for sequencer connections
  # ENV: SERVER_LISTEN_ADDR
  listen_addr: ":8080"

  # Connection timeouts
  # ENV: SERVER_WRITE_TIMEOUT
  write_timeout: 30s

  # Maximum message size in bytes (default: 10MB)
  # ENV: SERVER_MAX_MESSAGE_SIZE
  max_message_size: 10485760

  # Maximum number of concurrent connections
  # ENV: SERVER_MAX_CONNECTIONS
  max_connections: 100

# Authentication configuration
auth:
  # Enable authentication and message signing/verification
  # ENV: AUTH_ENABLED
  enabled: true

  # Shared Publisher private key (hex). Use scripts/generate_keys.go
  # ENV: AUTH_PRIVATE_KEY
  private_key: "YOUR_SP_PRIVATE_KEY_HEX"

  # Trusted sequencer public keys (compressed hex)
  trusted_sequencers:
    - id: "rollupA"
      public_key: "SEQ1_PUBLIC_KEY_HEX"
    - id: "rollupB"
      public_key: "SEQ2_PUBLIC_KEY_HEX"

# Metrics server configuration
metrics:
  # Enable metrics endpoint
  # ENV: METRICS_ENABLED
  enabled: true

  # HTTP port for metrics endpoint
  # ENV: METRICS_PORT
  port: 8081

  # Metrics path
  # ENV: METRICS_PATH
  path: /metrics

# HTTP API server (health, metrics, proofs API)
api:
  # HTTP listen address for API
  # ENV: API_LISTEN_ADDR
  listen_addr: ":8082"

  # Timeouts
  # ENV: API_READ_HEADER_TIMEOUT, API_READ_TIMEOUT, API_WRITE_TIMEOUT, API_IDLE_TIMEOUT
  read_header_timeout: 5s
  read_timeout: 15s
  write_timeout: 30s
  idle_timeout: 120s

  # Max header bytes (default 1MB)
  # ENV: API_MAX_HEADER_BYTES
  max_header_bytes: 1048576

# Logging configuration
log:
  # Log level: trace, debug, info, warn, error, fatal, panic
  # ENV: LOG_LEVEL
  level: info

  # Pretty print logs (true for development, false for production)
  # ENV: LOG_PRETTY
  pretty: false

  # Output destination: stdout, stderr, file
  # ENV: LOG_OUTPUT
  output: stdout

  # Log file path (only used if output=file)
  # ENV: LOG_FILE
  # file: /var/log/shared-publisher.log

# Consensus configuration
consensus:
  timeout: "60s"
  role: "leader"

# L1 (Ethereum) configuration for superblock publishing
l1:
  # RPC endpoint, e.g., ws://localhost:8546 or https://mainnet.infura.io/v3/<key>
  # ENV: L1_RPC_ENDPOINT
  rpc_endpoint: "ws://localhost:8546"

  # Deployed Superblock contract address
  # ENV: L1_SUPERBLOCK_CONTRACT
  superblock_contract: "0xYourContractAddress"

  # Chain ID (optional; auto-detected if omitted)
  # ENV: L1_CHAIN_ID
  chain_id: 1

  # Confirmation depths
  # ENV: L1_CONFIRMATIONS, L1_FINALITY_DEPTH
  confirmations: 2
  finality_depth: 64

  # EIP-1559 fee config (optional caps)
  # ENV: L1_USE_EIP1559, L1_MAX_FEE_PER_GAS_WEI, L1_MAX_PRIORITY_FEE_WEI, L1_GAS_LIMIT_BUFFER_PCT
  use_eip1559: true
  max_fee_per_gas_wei: "0"
  max_priority_fee_wei: "0"
  gas_limit_buffer_pct: 15

  # Signing (for local key signing)
  # ENV: L1_SHARED_PUBLISHER_PK_HEX
  shared_publisher_pk_hex: "YOUR_SP_PRIVATE_KEY_HEX"

  # Optional from address hint
  # ENV: L1_FROM_ADDRESS
  from_address: "0xYourPublisherEOA"

# Proofs pipeline configuration
# This section configures the generation and verification of cryptographic proofs
# for the superblocks before they are published on-chain.
proofs:
  # Enable or disable the entire proofs pipeline. If false, no proofs will be
  # generated or required for superblock submission.
  # ENV: PROOFS_ENABLED
  enabled: false

  # Configuration for the proof collector, which gathers proofs from different rollups.
  collector:
    # If true, the collector will wait for proofs from all registered chains
    # before considering the collection complete.
    # ENV: PROOFS_COLLECTOR_REQUIRE_ALL_CHAINS
    require_all_chains: true

    # The maximum time to wait for all required proofs to be collected.
    # If the timeout is reached, the collection attempt fails.
    # ENV: PROOFS_COLLECTOR_WAIT_TIMEOUT
    wait_timeout: 300s

    # A list of chain IDs that are required to submit proofs. If empty, and
    # require_all_chains is true, it will expect proofs from all trusted sequencers.
    # ENV: PROOFS_COLLECTOR_REQUIRED_CHAIN_IDS (comma-separated string)
    required_chain_ids: []

  # Configuration for the prover client, which interacts with the external
  # superblock prover service.
  prover:
    # The base URL of the superblock prover service.
    # ENV: PROOFS_PROVER_BASE_URL
    base_url: "http://superblock-prover:8080"

    # The interval at which to poll the prover service for proof generation status.
    # ENV: PROOFS_PROVER_POLL_INTERVAL
    poll_interval: 10s

    # The type of proof to request from the prover (e.g., "groth16", "risczero").
    # ENV: PROOFS_PROVER_PROOF_TYPE
    proof_type: "groth16"

  # If true, a valid proof must be successfully generated and verified before
  # the superblock is submitted to the L1 contract.
  # ENV: PROOFS_REQUIRE_PROOF
  require_proof: true
